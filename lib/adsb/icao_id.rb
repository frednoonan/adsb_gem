module ADSB
	class IcaoId
		attr_reader :country, :country_code

		# Data from http://www.kloth.net/radio/icao24alloc.php
		# and ISO-3166-1 alpha-2 country codes from
		# https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2
		@@prefixes = [
			["AF", "Afghanistan", "011100000000"],
			["AL", "Albania", "01010000000100"],
			["DZ", "Algeria", "000010100"],
			["AO", "Angola", "000010010000"],
			["AG", "Antigua and Barbuda", "00001100101000"],
			["AR", "Argentina", "111000"],
			["AM", "Armenia", "01100000000000"],
			["AU", "Australia", "011111"],
			["AT", "Austria", "010001000"],
			["AZ", "Azerbaijan", "01100000000010"],
			["BS", "Bahamas", "000010101000"],
			["BH", "Bahrain", "100010010100"],
			["BD", "Bangladesh", "011100000010"],
			["BB", "Barbados", "00001010101000"],
			["BY", "Belarus", "01010001000000"],
			["BE", "Belgium", "010001001"],
			["BZ", "Belize", "00001010101100"],
			["BJ", "Benin", "00001001010000"],
			["BT", "Bhutan", "01101000000000"],
			["BO", "Bolivia", "111010010100"],
			["BA", "Bosnia and Herzegovina", "01010001001100"],
			["BW", "Botswana", "00000011000000"],
			["BR", "Brazil", "111001"],
			["BN", "Brunei Darussalam", "10001001010100"],
			["BG", "Bulgaria", "010001010"],
			["BF", "Burkina Faso", "000010011100"],
			["BI", "Burundi", "000000110010"],
			["KH", "Cambodia", "011100001110"],
			["CM", "Cameroon", "000000110100"],
			["CA", "Canada", "110000"],
			["CV", "Cape Verde", "00001001011000"],
			["CF", "Central African Republic", "000001101100"],
			["TD", "Chad", "000010000100"],
			["CL", "Chile", "111010000000"],
			["CN", "China", "011110"],
			["CO", "Colombia", "000010101100"],
			["KM", "Comoros", "00000011010100"],
			["CD", "Congo", "000000110110"],
			["CK", "Cook Islands", "10010000000100"],
			["CR", "Costa Rica", "000010101110"],
			["CI", "C\303\264te d Ivoire", "000000111000"],
			["HR", "Croatia", "01010000000111"],
			["CU", "Cuba", "000010110000"],
			["CY", "Cyprus", "01001100100000"],
			["CZ", "Czech Republic", "010010011"],
			["KP", "Democratic People's Republic of Korea", "011100100"],
			["CD", "Democratic Republic of the Congo", "000010001100"],
			["DK", "Denmark", "010001011"],
			["DJ", "Djibouti", "00001001100000"],
			["DO", "Dominican Republic", "000011000100"],
			["EC", "Ecuador", "111010000100"],
			["EG", "Egypt", "000000010"],
			["SV", "El Salvador", "000010110010"],
			["GQ", "Equatorial Guinea", "000001000010"],
			["ER", "Eritrea", "00100000001000"],
			["EE", "Estonia", "01010001000100"],
			["ET", "Ethiopia", "000001000000"],
			["FJ", "Fiji", "110010001000"],
			["FI", "Finland", "010001100"],
			["FR", "France", "001110"],
			["GA", "Gabon", "000000111110"],
			["GM", "Gambia", "000010011010"],
			["GE", "Georgia", "01010001010000"],
			["DE", "Germany", "001111"],
			["GH", "Ghana", "000001000100"],
			["GR", "Greece", "010001101"],
			["GD", "Grenada", "00001100110000"],
			["GT", "Guatemala", "000010110100"],
			["GN", "Guinea", "000001000110"],
			["GW", "Guinea-Bissau", "00000100100000"],
			["GY", "Guyana", "000010110110"],
			["HT", "Haiti", "000010111000"],
			["HN", "Honduras", "000010111010"],
			["HU", "Hungary", "010001110"],
			["IS", "Iceland", "010011001100"],
			["IN", "India", "100000"],
			["ID", "Indonesia", "100010100"],
			["IR", "Iran, Islamic Republic of", "011100110"],
			["IQ", "Iraq", "011100101"],
			["GB", "Ireland", "010011001010"],
			["IL", "Israel", "011100111"],
			["IT", "Italy", "001100"],
			["JM", "Jamaica", "000010111110"],
			["JP", "Japan", "100001"],
			["JO", "Jordan", "011101000"],
			["KZ", "Kazakhstan", "01101000001100"],
			["KE", "Kenya", "000001001100"],
			["KI", "Kiribati", "11001000111000"],
			["KW", "Kuwait", "011100000110"],
			["KG", "Kyrgyzstan", "01100000000100"],
			["LA", "Lao People's Democratic Republic", "011100001000"],
			["LV", "Latvia", "01010000001011"],
			["LB", "Lebanon", "011101001"],
			["LS", "Lesotho", "00000100101000"],
			["LR", "Liberia", "000001010000"],
			["LY", "Libyan Arab Jamahiriya", "000000011"],
			["LT", "Lithuania", "01010000001111"],
			["LU", "Luxembourg", "01001101000000"],
			["MG", "Madagascar", "000001010100"],
			["MW", "Malawi", "000001011000"],
			["MY", "Malaysia", "011101010"],
			["MV", "Maldives", "00000101101000"],
			["ML", "Mali", "000001011100"],
			["MT", "Malta", "01001101001000"],
			["MH", "Marshall Islands", "10010000000000"],
			["MR", "Mauritania", "00000101111000"],
			["MU", "Mauritius", "00000110000000"],
			["MX", "Mexico", "000011010"],
			["FM", "Micronesia, Federated States of", "01101000000100"],
			["MC", "Monaco", "01001101010000"],
			["MN", "Mongolia", "01101000001000"],
			["MA", "Morocco", "000000100"],
			["MZ", "Mozambique", "000000000110"],
			["MM", "Myanmar", "011100000100"],
			["NA", "Namibia", "00100000000100"],
			["NR", "Nauru", "11001000101000"],
			["NP", "Nepal", "011100001010"],
			["NL", "Netherlands, Kingdom of the", "010010000"],
			["NZ", "New Zealand", "110010000"],
			["NI", "Nicaragua", "000011000000"],
			["NE", "Niger", "000001100010"],
			["NG", "Nigeria", "000001100100"],
			["NO", "Norway", "010001111"],
			["OM", "Oman", "01110000110000"],
			["PK", "Pakistan", "011101100"],
			["PW", "Palau", "01101000010000"],
			["PA", "Panama", "000011000010"],
			["PG", "Papua New Guinea", "100010011000"],
			["PY", "Paraguay", "111010001000"],
			["PE", "Peru", "111010001100"],
			["PH", "Philippines", "011101011"],
			["PL", "Poland", "010010001"],
			["PT", "Portugal", "010010010"],
			["QA", "Qatar", "00000110101000"],
			["KR", "Republic of Korea", "011100011"],
			["MD", "Republic of Moldova", "01010000010011"],
			["RO", "Romania", "010010100"],
			["RU", "Russian Federation", "0001"],
			["RW", "Rwanda", "000001101110"],
			["LC", "Saint Lucia", "11001000110000"],
			["VC", "Saint Vincent and the Grenadines", "00001011110000"],
			["AS", "Samoa", "10010000001000"],
			["SM", "San Marino", "01010000000000"],
			["ST", "Sao Tome and Principe", "00001001111000"],
			["SA", "Saudi Arabia", "011100010"],
			["SN", "Senegal", "000001110000"],
			["SC", "Seychelles", "00000111010000"],
			["SL", "Sierra Leone", "00000111011000"],
			["SG", "Singapore", "011101101"],
			["SK", "Slovakia", "01010000010111"],
			["SI", "Slovenia", "01010000011011"],
			["SB", "Solomon Islands", "10001001011100"],
			["SO", "Somalia", "000001111000"],
			["ZA", "South Africa", "000000001"],
			["ES", "Spain", "001101"],
			["LK", "Sri Lanka", "011101110"],
			["SD", "Sudan", "000001111100"],
			["SR", "Suriname", "000011001000"],
			["SZ", "Swaziland", "00000111101000"],
			["SE", "Sweden", "010010101"],
			["CH", "Switzerland", "010010110"],
			["SY", "Syrian Arab Republic", "011101111"],
			["TJ", "Tajikistan", "01010001010100"],
			["TH", "Thailand", "100010000"],
			["MK", "The former Yugoslav Republic of Macedonia", "01010001001000"],
			["TG", "Togo", "000010001000"],
			["TO", "Tonga", "11001000110100"],
			["TT", "Trinidad and Tobago", "000011000110"],
			["TN", "Tunisia", "000000101"],
			["TR", "Turkey", "010010111"],
			["TM", "Turkmenistan", "01100000000110"],
			["UG", "Uganda", "000001101000"],
			["UA", "Ukraine", "010100001"],
			["AE", "United Arab Emirates", "100010010110"],
			["GB", "United Kingdom", "010000"],
			["TZ", "United Republic of Tanzania", "000010000000"],
			["UM", "United States", "1010"],
			["UY", "Uruguay", "111010010000"],
			["UZ", "Uzbekistan", "01010000011111"],
			["VU", "Vanuatu", "11001001000000"],
			["VE", "Venezuela", "000011011"],
			["VN", "Viet Nam", "100010001"],
			["YE", "Yemen", "100010010000"],
			["ZM", "Zambia", "000010001010"],
			["ZW", "Zimbabwe", "00000000010000"],
			["YU", "Yugoslavia", "010011000"],
			["--", "ICAO (temporary)", "111100000"],
			["--", "ICAO (special use)", "10001001100100"],
			["--", "ICAO (special use)", "11110000100100"]]

		# create an ICAO-ID object from a hex string.
		def initialize(id_string)
			@id_string = id_string.upcase
			# TODO: optimize
			id_bits = "%024b" % [ id_string.to_i(16) ]
			@@prefixes.each do |p|
				country_code = p[0]
				country      = p[1]
				prefix       = p[2]
				if id_bits[0..prefix.length-1] == prefix then
					@country_code = country_code
					@country      = country
				end
			end
			if ! @country then
				raise ArgumentError, "ICAO-ID without matching allocation!"
			end
		end

		def to_s
			@id_string
		end
	end
end
